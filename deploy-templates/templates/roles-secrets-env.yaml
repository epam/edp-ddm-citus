{{- $secret := (lookup "v1" "Secret" .Values.namespace .Values.citus.secrets.citusSecrets.rolesSecret ) -}}
apiVersion: v1
kind: Secret
metadata:
  name: citus-roles-secrets
type: Opaque
data:
  {{- if not $secret }}
  {{- range $key, $value := .Values.citus.secrets.citusRolesSecrets }}
  {{ $key }}Pass: {{ randAlphaNum 12 | b64enc | quote }}
  {{- end }}
  {{- else }}
  {{- range $key, $value := .Values.citus.secrets.citusRolesSecrets }}
    {{- $keyName := (print $key "Name") }}
  {{- if hasKey $secret.data $keyName }}
  {{ $key }}Pass: {{ index $secret.data $keyName }}
  {{- else }}
  {{ $key }}Pass: {{ randAlphaNum 12 | b64enc | quote }}
  {{- end }}
  {{- end }}
  {{- end }}
  {{- range $key, $value := .Values.citus.secrets.citusRolesSecrets }}
  {{ $key }}Name: {{ $value | b64enc }}
  {{- end }}
